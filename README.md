# Laravel SEO

[![Latest Stable Version](https://img.shields.io/packagist/v/romanzipp/Laravel-SEO.svg?style=flat-square)](https://packagist.org/packages/romanzipp/laravel-seo)
[![Total Downloads](https://img.shields.io/packagist/dt/romanzipp/Laravel-SEO.svg?style=flat-square)](https://packagist.org/packages/romanzipp/laravel-seo)
[![License](https://img.shields.io/packagist/l/romanzipp/Laravel-SEO.svg?style=flat-square)](https://packagist.org/packages/romanzipp/laravel-seo)
[![Code Quality](https://img.shields.io/scrutinizer/g/romanzipp/Laravel-SEO.svg?style=flat-square)](https://scrutinizer-ci.com/g/romanzipp/Laravel-SEO/?branch=master)
[![Build Status](https://img.shields.io/travis/romanzipp/Laravel-SEO.svg?style=flat-square)](https://travis-ci.org/romanzipp/Laravel-SEO)

A SEO package made for maximum customization and flexibility.

## Contents

- [Installation](#installation)
- [Configuration](#configuration)
- [Documentation](#documentation)
- [Usage](#usage)
  - [Laravel-Mix Integration](#laravel-mix-integration)
  - [Schema.org Integration](#schemaorg-integration)
- [Upgrading from 1.0 to **2.0**](#upgrading)
- [Cheat Sheet](#cheat-sheet)
- [Testing](#testing)

## Installation

```
composer require romanzipp/laravel-seo
```

**If you use Laravel 5.5+ you are already done, otherwise continue.**

Add Service Provider to your `app.php` configuration file:

```php
romanzipp\Seo\Providers\SeoServiceProvider::class,
```

## Configuration

Copy configuration to config folder:

```
$ php artisan vendor:publish --provider="romanzipp\Seo\Providers\SeoServiceProvider"
```

## Documentation

[Documentation](https://github.com/romanzipp/Laravel-SEO/blob/master/docs/INDEX.md)

## Usage

### Instantiation

```php
use romanzipp\Seo\Facades\Seo;
use romanzipp\Seo\Services\SeoService;

class IndexController
{
    public function index(Request $request, SeoService $seo)
    {
        $seo = seo();

        $seo = app(SeoService::class);

        $seo = Seo::make();
    }
}
```

### Examples

Take a look at an [example app](https://github.com/romanzipp/Laravel-SEO/blob/master/docs/EXAMPLE-APP.md) for more detailed usage.

#### Title

```php
seo()->title('romanzipp');
```

```php
use romanzipp\Seo\Structs\Title;

seo()->add(
    Title::make()->body('romanzipp')
);
```

... both compile to ...

```html
<title>romanzipp</title>
```

#### Charset

```php
use romanzipp\Seo\Structs\Meta\Charset;

seo()->add(
    Charset::make()->charset('utf-8')
);
```

... compiles to ...

```html
<meta charset="utf-8" />
```

#### Twitter

```php
seo()->twitter('card', 'summary');
```

```php
use romanzipp\Seo\Structs\Meta\Twitter;

seo()->add(
    Twitter::make()->name('card')->content('summary')
);
```

... both compile to ...

```html
<meta name="twitter:card" content="summary" />
```

#### Open Graph

```php
seo()->og('site_name', 'romanzipp');
```

```php
use romanzipp\Seo\Structs\Meta\OpenGraph;

seo()->add(
    OpenGraph::make()->name('site_name')->content('romanzipp')
);
```

... both compile to ...

```html
<meta name="og:site_name" content="romanzipp" />
```

For more information see the [Structs Documentation](https://github.com/romanzipp/Laravel-SEO/blob/master/docs/STRUCTS.md).

### Render

```blade
{{ seo()->render() }}
```

## Laravel-Mix Integration

You can include your `mix-manifest.json` file generated by [Laravel-Mix](https://laravel-mix.com) to automatically add preload/prefetch link elements to your document head.

### Basic example

```php
seo()
    ->mix()
    ->load();
```

**mix-manifest.json**

```json
{
  "/js/app.js": "/js/app.js?id=123456789",
  "/css/app.css": "/css/app.css?id=123456789"
}
```

**document `<head>`**

```html
<link rel="prefetch" href="/js/app.js?id=123456789" />
<link rel="prefetch" href="/css/app.css?id=123456789" />
```

### Extended usage

Take a look at the **[SEO Laravel-Mix intregration docs](https://github.com/romanzipp/Laravel-SEO/blob/master/docs/LARAVEL-MIX.md)** for further usage.

```php
use romanzipp\Seo\Conductors\Types\ManifestAsset;

seo()
    ->mix()
    ->map(static function(ManifestAsset $asset): ?ManifestAsset {

        if (strpos($asset->path, 'admin') !== false) {
            return null;
        }

        $asset->url = 'http://localhost' . $asset->url;

        return $asset;
    })
    ->load(public_path('custom-manifest.json'));
```

## Schema.org Integration

This package features a basic integration for [Spaties Schema.org](https://github.com/spatie/schema-org) package to generate ld+json scripts.
Added Schema types render with the packages structs.

```php
use Spatie\SchemaOrg\Schema;

seo()->addSchema(
    Schema::localBusiness()->name('Spatie')
);
```

```php
use Spatie\SchemaOrg\Schema;

seo()->setSchemes([
    Schema::localBusiness()->name('Spatie'),
    Schema::airline()->name('Spatie'),
]);
```

Take a look at the [Schema.org package Docs](https://github.com/spatie/schema-org#usage).

## Upgrading

Upgrading from 1.0 to **2.0**

### SeoService

#### The `clear` Method

The `clear` method has been renamed to a more consistent `clearStructs` method.

```diff
- seo()->clear();
+ seo()->clearStructs();
```

#### The `render` Method

The `render` method now returns a `RenderConductor` which implements the `Renderable`, `Htmlable` and `Arrayable` interfaces instead of a `HtmlString`.

```diff
/** @var $content string */
- $content = (string) seo()->render();
+ $content = seo()->render()->toHtml();
```

You can still use `{{ seo()->render() }}` in Blade templates.

```diff
/** @var $content array */
- $content = seo()->renderContentsArray();
+ $content = seo()->render()->toArray();
```

```diff
/** @var $content Illuminate\Support\HtmlString */
- $content = seo()->render();
+ $content = seo()->render()->build();
```

### Structs

#### The `defaults` Method

The **romanzipp\Seo\Structs\Struct::defaults()** method now has a return type of `void`.

```diff
class CustomStruct extends Struct
{
-   public static function defaults(Struct $struct)
+   public static function defaults(Struct $struct): void
    {
        $struct->addAttribute('name', 'custom');
    }
}
```

#### Fluent Setters

All fluent setter methods now share the same return type of `romanzipp\Seo\Structs\Struct`.

```diff
use romanzipp\Seo\Structs\Struct;

class CustomStruct extends Meta
{
-   public function property($value = null, bool $escape = true): self
+   public function property($value = null, bool $escape = true): Struct
    {
        $this->addAttribute('property', 'custom:' . $value, $escape);

        return $this;
    }
}

```

### Laravel-Mix

#### The `filter` and `reject` Methods

Both `filter` and `reject` methods in the Laravel-Mix integration have been replaced with a more general `map` method.

```diff
seo()
    ->mix()
-   ->filter(function ($path, $url) {
-       // ...
-   })
-   ->reject(function ($path, $url) {
-       // ...
-   });
+   ->map(static function (ManifestAsset $asset): ?ManifestAsset {
+       // ...
+   });
```

#### The `rel` Method

The `rel` setter for the Laravel-Mix integration has been removed.

```diff
seo()
    ->mix()
-   ->rel('preload');
+   ->map(static function (ManifestAsset $asset): ?ManifestAsset {
+       $asset->rel = 'preload';
+       return $asset;
+   });
```

#### The `getAssets` Method

The `MixManifestConductor::getAssets()` method now returns an array of type ` ManifestAsset[]`.

## Cheat Sheet

| Code | Rendered HTML |
|--|--|
| `seo()->title('romanzipp')` | `<title>romanzipp</title>` |
| `seo()->meta('author', 'romanzipp')` | `<meta name="author" content="romanzipp" />` |
| `seo()->twitter('card', 'summary')` | `<meta name="twitter:card" content="summary" />` |
| `seo()->og('site_name', 'romanzipp')` | `<meta name="og:site_name" content="romanzipp" />` |
| `seo()->add(Charset::make()->charset('utf-8'))` | `<meta charset="utf-8" />` |

## Testing

```
./vendor/bin/phpunit
```
